<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.mingyuansoftware.aifactory.mapper.CustomerContactMapper">
    <resultMap id="BaseResultMap" type="com.mingyuansoftware.aifactory.model.CustomerContact">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="customer_contact_id" property="customerContactId" jdbcType="INTEGER"/>
        <result column="customer_id" property="customerId" jdbcType="INTEGER"/>
        <result column="name" property="name" jdbcType="VARCHAR"/>
        <result column="position" property="position" jdbcType="VARCHAR"/>
        <result column="phone" property="phone" jdbcType="VARCHAR"/>
        <result column="mobile" property="mobile" jdbcType="VARCHAR"/>
        <result column="mail" property="mail" jdbcType="VARCHAR"/>
        <result column="comment" property="comment" jdbcType="VARCHAR"/>
        <result column="is_delete" property="isDelete" jdbcType="TINYINT"/>
        <association column="custoemr_id" property="customer"
                     select="com.mingyuansoftware.aifactory.mapper.CustomerMapper.selectCustomerByCId"></association>
        <!--两张表中的id字段名相同，导致无法正常映射。解决办法是为列起别名。-->
        <!-- <association property="customer" javaType="com.mingyuansoftware.aifactory.model.Customer">
             <id column="customerId" property="customerId"/>
             <result column="customerNumber" property="customerNumber"/>
             <result column="customerName" property="customerName"/>
             <result column="phone" property="phone"/>
             <result column="address" property="address"/>
             <result column="comment" property="comment"/>
             <result column="introduction" property="introduction"/>
             <result column="fax" property="fax"/>
             <result column="financialContact" property="financialContact"/>
             <result column="bankAccount" property="bankAccount"/>
             <result column="accountNumber" property="accountNumber"/>
             <result column="creditCode" property="creditCode"/>
             <result column="taxNumber" property="taxNumber"/>
             <result column="accountPeriod" property="accountPeriod"/>
             <result column="returnCredit" property="returnCredit"/>
             <result column="customerValue" property="customerValue"/>
             <result column="annualSales" property="annualSales"/>
             <result column="isDelete" property="isDelete"/>
         </association>-->
    </resultMap>
    <select id="selectCustomerDetailByCId" resultMap="BaseResultMap" parameterType="java.lang.Integer">
        select
        cc.customer_contact_id,cc.`name`,cc.position,cc.phone,cc.mobile,cc.mail,cc.`comment`,cc.customer_id,cc.is_delete
        from customer_contact as cc
        <where>
            and cc.customer_id = #{customerId,jdbcType=INTEGER}
            and cc.is_delete = 0
        </where>
    </select>
    <select id="count" resultType="java.lang.Integer">
    select cc.customer_contact_id,cc.`name`,cc.position,cc.phone,cc.mobile,cc.mail,cc.`comment`,
    c.customer_id as customerId,c.customer_number as customerNumber,c.customer_name as customerName,
    c.introduction as introduction,c.phone as phone,c.fax as fax,c.address as address,c.comment as comment,
    c.financial_contact as financialContact,c.bank_account as bankAccount,c.account_number as accountNumber,
    c.credit_code as creditCode,c.tax_number as taxNumber,c.account_period as accountPeriod,
    c.return_credit as returnCredit,c.customer_value as customerValue,c.annual_sales as annualSales,c.is_delete as isDelete,
    cc.is_delete
    from customer_contact as cc
    left join customer as c on cc.customer_id = c.customer_id
    where cc.is_delete = 0
  </select>
    <delete id="deleteCustomerContactByCId" parameterType="java.lang.Integer">
        delete from customer_contact
        where customer_id = #{customerContactId,jdbcType=INTEGER}
    </delete>
    <insert id="addcustomerContact" parameterType="com.mingyuansoftware.aifactory.model.CustomerContact">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <selectKey resultType="java.lang.Integer" keyProperty="customerContactId" order="AFTER">
            SELECT LAST_INSERT_ID()
        </selectKey>
        insert into customer_contact (`name`, `position`, phone,
        mobile, mail, `comment`,
        customer_id)
        values (#{name,jdbcType=VARCHAR}, #{position,jdbcType=VARCHAR}, #{phone,jdbcType=VARCHAR},
        #{mobile,jdbcType=VARCHAR}, #{mail,jdbcType=VARCHAR}, #{comment,jdbcType=VARCHAR},
        #{customerId,jdbcType=INTEGER})
    </insert>
    <update id="updateByPrimaryKey" parameterType="com.mingyuansoftware.aifactory.model.CustomerContact">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update customer_contact
        set `name` = #{name,jdbcType=VARCHAR},
        `position` = #{position,jdbcType=VARCHAR},
        phone = #{phone,jdbcType=VARCHAR},
        mobile = #{mobile,jdbcType=VARCHAR},
        mail = #{mail,jdbcType=VARCHAR},
        `comment` = #{comment,jdbcType=VARCHAR},
        customer_id = #{customerId,jdbcType=INTEGER},
        is_delete = #{isDelete,jdbcType=TINYINT}
        where customer_contact_id = #{customerContactId,jdbcType=INTEGER}
    </update>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select customer_contact_id, `name`, `position`, phone, mobile, mail, `comment`, customer_id,
        is_delete
        from customer_contact
        where customer_contact_id = #{customerContactId,jdbcType=INTEGER}
    </select>
    <!--获取客户联系人列表-->
    <select id="customerContactList" resultType="com.mingyuansoftware.aifactory.model.CustomerContact"
            parameterType="java.lang.Integer">
    select * from customer_contact
    where customer_contact_id = #{customerContactId,jdbcType=INTEGER}
  </select>
    <update id="updateCustomerContactByCId">
        update customer_contact
        set is_delete = 1
        where customer_id = #{customerId,jdbcType=INTEGER}
    </update>
</mapper>