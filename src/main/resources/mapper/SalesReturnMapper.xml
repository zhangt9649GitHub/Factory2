<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.mingyuansoftware.aifactory.mapper.SalesReturnMapper">
  <resultMap id="BaseResultMap" type="com.mingyuansoftware.aifactory.model.SalesReturn">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="sales_return_id" jdbcType="INTEGER" property="salesReturnId" />
    <result column="sales_return_number" jdbcType="VARCHAR" property="salesReturnNumber" />
    <result column="add_time" jdbcType="DATE" property="addTime" />
    <result column="sales_order_id" jdbcType="INTEGER" property="salesOrderId" />
    <result column="state" jdbcType="TINYINT" property="state" />
    <result column="payment_status" jdbcType="TINYINT" property="paymentStatus" />
    <result column="amount" jdbcType="DECIMAL" property="amount" />
    <result column="amount_received" jdbcType="DECIMAL" property="amountReceived" />
    <result column="outstanding_amount" jdbcType="DECIMAL" property="outstandingAmount" />
    <result column="comment" jdbcType="VARCHAR" property="comment" />
    <result column="create_time" jdbcType="TIMESTAMP" property="createTime" />
    <result column="update_time" jdbcType="TIMESTAMP" property="updateTime" />
    <result column="is_delete" jdbcType="TINYINT" property="isDelete" />
    <result column="total_boxes_number" jdbcType="INTEGER" property="totalBoxesNumber" />
    <result column="total_amount" jdbcType="DECIMAL" property="totalAmount" />
    <result column="total_net_weight" jdbcType="DECIMAL" property="totalNetWeight" />
    <result column="total_gross_weight" jdbcType="DECIMAL" property="totalGrossWeight" />
    <result column="total_volume" jdbcType="DECIMAL" property="totalVolume" />
    <result column="customer_id" jdbcType="INTEGER" property="customerId" />
    <result column="customer_name" property="customerName" jdbcType="VARCHAR"/>
    <association column="sales_order_id" property="salesOrder"
                 select="com.mingyuansoftware.aifactory.mapper.SalesOrderMapper.selectByPrimaryKey"></association>
    <association column="staff_id" property="staff"
                 select="com.mingyuansoftware.aifactory.mapper.StaffMapper.selectByPrimaryKey"></association>
    <association column="customer_id" property="customer"
                 select="com.mingyuansoftware.aifactory.mapper.CustomerMapper.selectCustomerByCId"></association>
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from sales_return
    where sales_return_id = #{salesReturnId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.mingyuansoftware.aifactory.model.SalesReturn">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey keyProperty="salesReturnId" order="AFTER" resultType="java.lang.Integer">
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into sales_return (sales_return_number, add_time, customer_id, 
      sales_order_id, `state`, payment_status, 
      amount, amount_received, outstanding_amount, 
      `comment`, create_time, update_time, 
      is_delete, staff_id, total_boxes_number, 
      total_amount, total_net_weight,
      total_gross_weight, total_volume)
    values (#{salesReturnNumber,jdbcType=VARCHAR}, #{addTime,jdbcType=DATE}, #{customerId,jdbcType=INTEGER}, 
      #{salesOrderId,jdbcType=INTEGER}, #{state,jdbcType=TINYINT}, #{paymentStatus,jdbcType=TINYINT}, 
      #{amount,jdbcType=DECIMAL}, #{amountReceived,jdbcType=DECIMAL}, #{outstandingAmount,jdbcType=DECIMAL}, 
      #{comment,jdbcType=VARCHAR}, #{createTime,jdbcType=TIMESTAMP}, #{updateTime,jdbcType=TIMESTAMP}, 
      #{isDelete,jdbcType=TINYINT}, #{staffId,jdbcType=INTEGER}, #{totalBoxesNumber,jdbcType=INTEGER}, 
      #{totalAmount,jdbcType=DECIMAL}, #{totalNetWeight,jdbcType=DECIMAL},
      #{totalGrossWeight,jdbcType=DECIMAL}, #{totalVolume,jdbcType=DECIMAL})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.mingyuansoftware.aifactory.model.SalesReturn">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update sales_return
    set sales_return_number = #{salesReturnNumber,jdbcType=VARCHAR},
      add_time = #{addTime,jdbcType=DATE},
      customer_id = #{customerId,jdbcType=INTEGER},
      sales_order_id = #{salesOrderId,jdbcType=INTEGER},
      `state` = #{state,jdbcType=TINYINT},
      payment_status = #{paymentStatus,jdbcType=TINYINT},
      amount = #{amount,jdbcType=DECIMAL},
      amount_received = #{amountReceived,jdbcType=DECIMAL},
      outstanding_amount = #{outstandingAmount,jdbcType=DECIMAL},
      `comment` = #{comment,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=TIMESTAMP},
      update_time = #{updateTime,jdbcType=TIMESTAMP},
      is_delete = #{isDelete,jdbcType=TINYINT},
      staff_id = #{staffId,jdbcType=INTEGER},
      total_boxes_number = #{totalBoxesNumber,jdbcType=INTEGER},
      total_amount = #{totalAmount,jdbcType=DECIMAL},
      total_net_weight = #{totalNetWeight,jdbcType=DECIMAL},
      total_gross_weight = #{totalGrossWeight,jdbcType=DECIMAL},
      total_volume = #{totalVolume,jdbcType=DECIMAL}
    where sales_return_id = #{salesReturnId,jdbcType=INTEGER}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select sales_return_id, sales_return_number, add_time, customer_id, sales_order_id,
    `state`, payment_status, amount, amount_received, outstanding_amount, `comment`, 
    create_time, update_time, is_delete, staff_id, total_boxes_number, total_amount, 
    total_net_weight, total_gross_weight, total_volume
    from sales_return
    where sales_return_id = #{salesReturnId,jdbcType=INTEGER}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select sales_return_id, sales_return_number, add_time, customer_id, sales_order_id, 
    `state`, payment_status, amount, amount_received, outstanding_amount, `comment`, 
    create_time, update_time, is_delete, staff_id, total_boxes_number, total_amount, 
    total_net_weight, total_gross_weight, total_volume
    from sales_return
  </select>

  <select id="selectSalesReturnList" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select sr.sales_return_id, sr.sales_return_number, sr.add_time, sr.customer_id, sr.sales_order_id,
    sr.`state`, sr.payment_status, sr.amount, sr.amount_received, sr.outstanding_amount, sr.`comment`,
    sr.create_time, sr.update_time, sr.is_delete, sr.staff_id, sr.total_boxes_number, sr.total_amount,
    sr.total_net_weight, sr.total_gross_weight, sr.total_volume,cu.customer_name
    from sales_return AS sr
    LEFT JOIN customer AS cu ON (sr.customer_id =cu.customer_id)
    <where>
      <if test="salesReturnDto.salesReturnNumber != null and salesReturnDto.salesReturnNumber != ''">
        AND sr.sales_return_number like "%"#{salesReturnDto.salesReturnNumber}"%"
      </if>
      <if test="salesReturnDto.addTime != null and salesReturnDto.addTime != ''">
        AND sr.add_time like "%"#{salesReturnDto.addTime}"%"
      </if>
      <if test="salesReturnDto.customerName != null and salesReturnDto.customerName  != ''">
        AND cu.customer_name like "%"#{salesReturnDto.customerName }"%"
      </if>
      <if test="salesReturnDto.state != null and salesReturnDto.state != ''">
        AND sr.`state` = #{salesReturnDto.state}
      </if>
      <if test="salesReturnDto.paymentStatus != null and salesReturnDto.paymentStatus  != ''">
        AND sr.payment_status = #{salesReturnDto.paymentStatus}
      </if>
      <if test="salesReturnDto.amount != null and salesReturnDto.amount  != '' or salesReturnDto.amount == '0'.toString()">
        AND sr.amount = #{salesReturnDto.amount}
      </if>
      <if test="salesReturnDto.amountReceived != null and salesReturnDto.amountReceived  != ''or salesReturnDto.amountReceived == '0'.toString()">
        AND sr.amount_received  = #{salesReturnDto.amountReceived}
      </if>
      <if test="salesReturnDto.comment != null and salesReturnDto.comment  != ''">
        AND sr.`comment` like "%"#{salesReturnDto.comment}"%"
      </if>
      AND sr.is_delete = 0
    </where>
    ORDER BY sr.sales_return_id DESC
  </select>


  <select id="selectSalesReturnCount" resultType="java.lang.Integer">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select count(sr.sales_return_id)
    from sales_return AS sr
    LEFT JOIN customer AS cu ON (sr.customer_id =cu.customer_id)
    <where>
      <if test="salesReturnDto.salesReturnNumber != null and salesReturnDto.salesReturnNumber != ''">
        AND sr.sales_return_number like "%"#{salesReturnDto.salesReturnNumber}"%"
      </if>
      <if test="salesReturnDto.addTime != null and salesReturnDto.addTime != ''">
        AND sr.add_time like "%"#{salesReturnDto.addTime}"%"
      </if>
      <if test="salesReturnDto.customerName != null and salesReturnDto.customerName  != ''">
        AND cu.customer_name like "%"#{salesReturnDto.customerName }"%"
      </if>
      <if test="salesReturnDto.state != null and salesReturnDto.state != ''">
        AND sr.`state` = #{salesReturnDto.state}
      </if>
      <if test="salesReturnDto.paymentStatus != null and salesReturnDto.paymentStatus  != ''">
        AND sr.payment_status = #{salesReturnDto.paymentStatus}
      </if>
      <if test="salesReturnDto.amount != null and salesReturnDto.amount  != '' or salesReturnDto.amount == '0'.toString()">
        AND sr.amount = #{salesReturnDto.amount}
      </if>
      <if test="salesReturnDto.amountReceived != null and salesReturnDto.amountReceived  != ''or salesReturnDto.amountReceived == '0'.toString()">
        AND sr.amount_received  = #{salesReturnDto.amountReceived}
      </if>
      <if test="salesReturnDto.comment != null and salesReturnDto.comment  != ''">
        AND sr.`comment` like "%"#{salesReturnDto.comment}"%"
      </if>
      AND sr.is_delete = 0
    </where>
    ORDER BY sr.sales_return_id DESC
  </select>

  <update id="updateSalesReturnById">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update sales_return
    set
    is_delete = 1,
    update_time = now()
    where sales_return_id = #{salesReturnId,jdbcType=INTEGER}
  </update>

  <select id="selectSalesReturnListById" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select sales_return_id, sales_return_number, add_time, customer_id, sales_order_id,
    `state`, payment_status, amount, amount_received, outstanding_amount, `comment`,
    create_time, update_time, is_delete, staff_id, total_boxes_number, total_amount,
    total_net_weight, total_gross_weight, total_volume
    from sales_return
    where sales_order_id = #{salesOrderId} and is_delete = 0 and state >= 2
  </select>

  <update id="updateSalesReturnState">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update sales_return
    set
    `state` = 2,
    update_time = now()
    where sales_return_id = #{salesReturnId,jdbcType=INTEGER}
  </update>
  <update id="updatePaymentInfoById" parameterType="com.mingyuansoftware.aifactory.model.SalesReturn">
    update sales_return
    set
    update_time = now(),
    payment_status = #{salesReturn1.paymentStatus,jdbcType=TINYINT},
    amount_received = #{salesReturn1.amountReceived,jdbcType=DECIMAL},
    outstanding_amount = #{salesReturn1.outstandingAmount,jdbcType=DECIMAL}
    where sales_return_id = #{salesReturn1.salesReturnId,jdbcType=INTEGER}
  </update>
  <select id="selectSalesReturnListForPayment" resultMap="BaseResultMap">
    select sr.sales_return_id, sr.sales_return_number, sr.add_time, sr.customer_id, sr.sales_order_id,
    sr.`state`, sr.payment_status, sr.amount, sr.amount_received, sr.outstanding_amount, sr.`comment`,
    sr.create_time, sr.update_time, sr.is_delete, sr.staff_id, sr.total_boxes_number, sr.total_amount,
    sr.total_net_weight, sr.total_gross_weight, sr.total_volume,cu.customer_name, cu.write_off_amount
    from sales_return AS sr
    LEFT JOIN customer AS cu ON (sr.customer_id =cu.customer_id)
    where sr.payment_status != 3
    ORDER BY sr.sales_return_id DESC
  </select>
</mapper>