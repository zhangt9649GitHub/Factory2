<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.mingyuansoftware.aifactory.mapper.StorageAccessMapper" >
  <resultMap id="BaseResultMap" type="com.mingyuansoftware.aifactory.model.StorageAccess" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="storage_access_id" property="storageAccessId" jdbcType="INTEGER" />
    <result column="storage_number" property="storageNumber" jdbcType="VARCHAR" />
    <result column="warehouse_id" property="warehouseId" jdbcType="INTEGER" />
    <result column="lot_number" property="lotNumber" jdbcType="VARCHAR" />
    <result column="create_staff_id" property="createStaffId" jdbcType="INTEGER" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
    <result column="comment" property="comment" jdbcType="VARCHAR" />
    <result column="type" property="type" jdbcType="VARCHAR" />
    <result column="is_delete" property="isDelete" jdbcType="INTEGER" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="ruku_time" property="rukuTime" jdbcType="VARCHAR" />
    <result column="amount" property="amount" jdbcType="DECIMAL" />
    <result column="warehouse_name" property="warehouseName" jdbcType="VARCHAR" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    UPDATE storage_access SET is_delete =1
    where storage_access_id = #{storageAccessId,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.mingyuansoftware.aifactory.model.StorageAccess" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey resultType="java.lang.Integer" keyProperty="storageAccessId" order="AFTER" >
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into storage_access (storage_number, warehouse_id, lot_number, 
      create_staff_id, create_time, update_time, 
      `comment`, `type`, is_delete,ruku_time,amount
      )
    values (#{storageNumber,jdbcType=VARCHAR}, #{warehouseId,jdbcType=INTEGER}, #{lotNumber,jdbcType=VARCHAR}, 
      #{createStaffId,jdbcType=INTEGER}, #{createTime,jdbcType=TIMESTAMP}, #{updateTime,jdbcType=TIMESTAMP}, 
      #{comment,jdbcType=VARCHAR}, #{type,jdbcType=VARCHAR}, #{isDelete,jdbcType=INTEGER},#{rukuTime,jdbcType=VARCHAR},#{amount,jdbcType=DECIMAL}
      )
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.mingyuansoftware.aifactory.model.StorageAccess" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update storage_access
    set storage_number = #{storageNumber,jdbcType=VARCHAR},
      warehouse_id = #{warehouseId,jdbcType=INTEGER},
      lot_number = #{lotNumber,jdbcType=VARCHAR},
      create_staff_id = #{createStaffId,jdbcType=INTEGER},
      update_time = #{updateTime,jdbcType=TIMESTAMP},
      `comment` = #{comment,jdbcType=VARCHAR},
      `type` = #{type,jdbcType=VARCHAR},
      `ruku_time` = #{rukuTime,jdbcType=VARCHAR},
      `amount` = #{amount,jdbcType=VARCHAR}
    where storage_access_id = #{storageAccessId,jdbcType=INTEGER}
  </update>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select sa.storage_access_id, sa.storage_number, sa.warehouse_id, sa.lot_number, sa.create_staff_id,
    sa.create_time, sa.update_time, sa.`comment`, sa.`type`,sa.is_delete,sa.ruku_time, sa.amount,sf.`name`,wh.warehouse_name
    from storage_access  sa
    LEFT JOIN staff  sf on(sa.create_staff_id = sf.staff_id)
    LEFT JOIN warehouse wh on (sa.warehouse_id =wh.warehouse_id)
    where sa.storage_access_id = #{storageAccessId,jdbcType=INTEGER} and sa.is_delete=0
  </select>
  <select id="selectAll" resultMap="BaseResultMap"  parameterType="com.mingyuansoftware.aifactory.model.dto.StorageAccessDto">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select sa.storage_access_id, sa.storage_number, sa.warehouse_id, sa.lot_number, sa.create_staff_id,
    sa.`comment`, sa.`type`,sa.is_delete,sa.ruku_time, sa.amount,sf.`name`,wh.warehouse_name
    from storage_access  sa
    LEFT JOIN staff  sf on(sa.create_staff_id = sf.staff_id)
    LEFT JOIN warehouse wh on (sa.warehouse_id =wh.warehouse_id)
    <where>
      <if test="storageNumber!= null and storageNumber != ''">
        AND sa.storage_number like "%"#{storageNumber}"%"
      </if>
      <if test="rukuTime != null and rukuTime!= ''">
        AND sa.ruku_time like "%"#{rukuTime}"%"
      </if>
      <if test="name != null and name != ''">
        AND sf.name like "%"#{name}"%"
      </if>
      <if test="warehouseName != null and warehouseName != ''">
        AND  wh.warehouse_name like "%"#{warehouseName}"%"
      </if>
      <if test="type != null and type != ''">
        AND  sa.`type` like "%"#{type}"%"
      </if>
      <if test="comment != null and comment != ''">
        AND sa.`comment` = #{comment}
      </if>
      AND sa.is_delete = 0
    </where>
   ORDER BY sa.storage_access_id DESC


  </select>


  <select id="selectInventoryGoodsList" resultType="com.mingyuansoftware.aifactory.model.dto.RequisitionGoodsDto" >
  <!--
    WARNING - @mbggenerated
    This element is automatically generated by MyBatis Generator, do not modify.
  -->
  select sg.goods_id, sg.quantity AS inventory,gd.parts_cd,gd.goods_name,gd.specification,gd.`unit`
  from storage_access as sa
  LEFT JOIN storage_goods AS sg ON (sa.storage_access_id = sg.storage_access_id)
  LEFT JOIN goods as gd ON (sg.goods_id = gd.goods_id)
  where sa.is_delete = 0 and gd.is_delete = 0 and sa.warehouse_id = #{warehouseId}
</select>

  <select id="selectInventoryGoodsCount" resultType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select count(sg.goods_id)
    from storage_access as sa
    LEFT JOIN storage_goods AS sg ON (sa.storage_access_id = sg.storage_access_id)
    LEFT JOIN goods as gd ON (sg.goods_id = gd.goods_id)
    where sa.is_delete = 0 and gd.is_delete = 0 and sa.warehouse_id = #{warehouseId}
  </select>

</mapper>