<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.mingyuansoftware.aifactory.mapper.StaffMapper" >
  <resultMap id="BaseResultMap" type="com.mingyuansoftware.aifactory.model.Staff" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="staff_id" property="staffId" jdbcType="INTEGER" />
    <result column="job_number" property="jobNumber" jdbcType="VARCHAR" />
    <result column="name" property="name" jdbcType="VARCHAR" />
    <result column="gender" property="gender" jdbcType="VARCHAR" />
    <result column="uf_id" property="ufId" jdbcType="INTEGER" />
    <result column="card_number" property="cardNumber" jdbcType="VARCHAR" />
    <result column="phone" property="phone" jdbcType="VARCHAR" />
    <result column="address" property="address" jdbcType="VARCHAR" />
    <result column="entry_time" property="entryTime" jdbcType="VARCHAR" />
    <result column="state" property="state" jdbcType="TINYINT" />
    <result column="is_turn_positive" property="isTurnPositive" jdbcType="TINYINT" />
    <result column="positive_time" property="positiveTime" jdbcType="VARCHAR" />
    <result column="department" property="department" jdbcType="VARCHAR" />
    <result column="biz_id" property="bizId" jdbcType="INTEGER" />
    <result column="role" property="role" jdbcType="VARCHAR" />
    <result column="post" property="post" jdbcType="VARCHAR" />
    <result column="comment" property="comment" jdbcType="VARCHAR" />
    <result column="is_delete" property="isDelete" jdbcType="TINYINT" />
    <result column="password" property="password" jdbcType="VARCHAR" />
    <result column="login_time" property="loginTime" jdbcType="TIMESTAMP" />
    <result column="login_ip" property="loginIp" jdbcType="VARCHAR" />
    <result column="group_id" property="groupId" jdbcType="VARCHAR" />
    <result column="train_salary" property="trainSalary" jdbcType="DECIMAL" />
    <result column="basic_salary" property="basicSalary" jdbcType="DECIMAL" />
    <result column="management_fee" property="managementFee" jdbcType="DECIMAL" />
    <result column="post_allowance" property="postAllowance" jdbcType="DECIMAL" />
    <result column="food_deduction" property="foodDeduction" jdbcType="DECIMAL" />
    <result column="tj_factory_deduction" property="tjFactoryDeduction" jdbcType="DECIMAL" />
    <result column="issocial" property="issocial" jdbcType="TINYINT" />
    <result column="departure_time" property="departureTime" jdbcType="TIMESTAMP" />
    <result column="insurance_company" property="insuranceCompany" jdbcType="VARCHAR" />
    <result column="dc_id" property="dcId" jdbcType="INTEGER" />
    <result column="fm_id" property="fmId" jdbcType="INTEGER" />
    <association column="group_id" property="staffAccessGroup"
                 select="com.mingyuansoftware.aifactory.mapper.StaffAccessGroupMapper.selectByPrimaryKey"></association>
    <association column="uf_id" property="uploadFiles"
                 select="com.mingyuansoftware.aifactory.mapper.UploadFilesMapper.selectByPrimaryKey"></association>
  </resultMap>

  <update id="deleteByPrimaryKey" parameterType="java.lang.Integer">
  UPDATE staff set is_delete=1
  where staff_id = #{staffId,jdbcType=INTEGER}

</update>


  <update id="updatePasswd" parameterType="com.mingyuansoftware.aifactory.model.Staff">
    UPDATE staff set `password` = #{password,jdbcType=VARCHAR}
    where staff_id = #{staffId,jdbcType=INTEGER}

  </update>

  <insert id="insert" parameterType="com.mingyuansoftware.aifactory.model.Staff" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey resultType="java.lang.Integer" keyProperty="staffId" order="AFTER" >
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into staff (job_number, `name`, gender, 
      uf_id, card_number, phone, 
      address, entry_time, `state`, 
      is_turn_positive, positive_time, department,biz_id,
      `role`, post, `comment`, password,group_id,
      is_delete, train_salary, basic_salary,management_fee,
      post_allowance,food_deduction,tj_factory_deduction, issocial,departure_time,insurance_company,dc_id,fm_id)
    values (#{jobNumber,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR}, #{gender,jdbcType=VARCHAR}, 
      #{ufId,jdbcType=INTEGER}, #{cardNumber,jdbcType=VARCHAR}, #{phone,jdbcType=VARCHAR}, 
      #{address,jdbcType=VARCHAR}, #{entryTime,jdbcType=VARCHAR}, #{state,jdbcType=TINYINT},
      #{isTurnPositive,jdbcType=TINYINT}, #{positiveTime,jdbcType=VARCHAR}, #{department,jdbcType=VARCHAR},#{bizId,jdbcType=INTEGER},
      #{role,jdbcType=VARCHAR}, #{post,jdbcType=VARCHAR}, #{comment,jdbcType=VARCHAR},#{password,jdbcType=VARCHAR},#{groupId,jdbcType=VARCHAR},
      #{isDelete,jdbcType=TINYINT}, #{trainSalary,jdbcType=DECIMAL},#{basicSalary,jdbcType=DECIMAL}, #{managementFee,jdbcType=DECIMAL},
      #{postAllowance,jdbcType=DECIMAL}, #{foodDeduction,jdbcType=DECIMAL}, #{tjFactoryDeduction,jdbcType=DECIMAL},#{issocial,jdbcType=TINYINT},
      #{departureTime,jdbcType=TIMESTAMP},#{insuranceCompany,jdbcType=VARCHAR},#{dcId,jdbcType=INTEGER},#{fmId,jdbcType=INTEGER}
      )
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.mingyuansoftware.aifactory.model.Staff" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update staff
    set job_number = #{jobNumber,jdbcType=VARCHAR},
      `name` = #{name,jdbcType=VARCHAR},
      gender = #{gender,jdbcType=VARCHAR},
      uf_id = #{ufId,jdbcType=INTEGER},
      card_number = #{cardNumber,jdbcType=VARCHAR},
      phone = #{phone,jdbcType=VARCHAR},
      address = #{address,jdbcType=VARCHAR},
      entry_time = #{entryTime,jdbcType=VARCHAR},
      `state` = #{state,jdbcType=TINYINT},
      is_turn_positive = #{isTurnPositive,jdbcType=TINYINT},
      positive_time = #{positiveTime,jdbcType=VARCHAR},
      department = #{department,jdbcType=VARCHAR},
      biz_id = #{bizId,jdbcType=INTEGER},
      `role` = #{role,jdbcType=VARCHAR},
      post = #{post,jdbcType=VARCHAR},
      `comment` = #{comment,jdbcType=VARCHAR},
      group_id = #{groupId,jdbcType=VARCHAR},
      train_salary = #{trainSalary,jdbcType=DECIMAL},
      basic_salary = #{basicSalary,jdbcType=DECIMAL},
      management_fee = #{managementFee,jdbcType=DECIMAL},
      post_allowance = #{postAllowance,jdbcType=DECIMAL},
      food_deduction = #{foodDeduction,jdbcType=DECIMAL},
      tj_factory_deduction = #{tjFactoryDeduction,jdbcType=DECIMAL},
      issocial = #{issocial,jdbcType=TINYINT},
      departure_time = #{departureTime,jdbcType=TIMESTAMP},
      insurance_company = #{insuranceCompany,jdbcType=VARCHAR},
      dc_id = #{dcId,jdbcType=INTEGER},
      fm_id = #{fmId,jdbcType=INTEGER}
    where staff_id = #{staffId,jdbcType=INTEGER}
  </update>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select staff_id, job_number, `name`, gender, uf_id, card_number, phone, address, 
    entry_time, `state`, is_turn_positive, positive_time, department, biz_id,`role`, post, `comment`, group_id,
    is_delete,train_salary, basic_salary,management_fee,post_allowance,food_deduction,tj_factory_deduction,
    issocial,departure_time,insurance_company,dc_id,fm_id
    from staff
    where staff_id = #{staffId,jdbcType=INTEGER} and is_delete=0
  </select>
  <select id="selectAll" resultMap="BaseResultMap" >
  <!--
    WARNING - @mbggenerated
    This element is automatically generated by MyBatis Generator, do not modify.
  -->
  select staff_id, job_number, `name`, gender, uf_id, card_number, phone, address,
  entry_time, `state`, is_turn_positive, positive_time, department, biz_id,`role`, post, `comment`,group_id,
  is_delete,dc_id,fm_id
  from staff
</select>

  <select id="selectName" resultMap="BaseResultMap" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select staff_id, job_number, `name`, gender
    from staff where is_delete = 0
  </select>

  <select id="selectByPage" resultMap="BaseResultMap" parameterType="com.mingyuansoftware.aifactory.model.dto.StaffDto">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select staff_id, job_number, `name`, gender, uf_id, card_number, phone, address,
    entry_time, `state`, is_turn_positive, positive_time, department, `role`, post, `comment`

    from staff
    <where>
      <if test="staffDto.jobNumber != null and staffDto.jobNumber != ''">
        AND job_number like "%"#{staffDto.jobNumber}"%"
      </if>
      <if test="staffDto.name != null and staffDto.name != ''">
        AND name like "%"#{staffDto.name}"%"
      </if>
      <if test="staffDto.phone != null and staffDto.phone  != ''">
        AND phone like "%"#{staffDto.phone }"%"
      </if>
      <if test="staffDto.role != null and staffDto.role != ''">
        AND role = #{staffDto.role}
      </if>
      <if test="staffDto.entryTime != null and staffDto.entryTime  != ''">
        AND entry_time =  #{staffDto.entryTime}

      </if>

      AND is_delete = 0
    </where>

  </select>

  <select id="selectStaffIdByNumber" resultMap="BaseResultMap" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select staff_id, job_number, `name`, gender, uf_id, card_number, phone, address,
    entry_time, `state`, is_turn_positive, positive_time, department, `role`, post, `comment`,group_id,
    is_delete
    from staff
    WHERE job_number = #{jobNumber}
  </select>

  <select id="selectAllStaff" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select staff_id, job_number, `name`, gender, uf_id, card_number, phone, address,
    entry_time, `state`, is_turn_positive, positive_time, department, biz_id,`role`, post, `comment`, group_id,
    is_delete,train_salary, basic_salary,management_fee,post_allowance,food_deduction,tj_factory_deduction,
    issocial,departure_time,insurance_company,dc_id,fm_id
    from staff
  </select>

  <select id="selectStaffListByBizId" resultType="com.mingyuansoftware.aifactory.model.StaffPayroll">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select sf.staff_id, sf.job_number, sf.`name`,dc.insurance_company,dc.insurance_deduction,dc.management_fee,
    fm.f_name,fm.food_deduction
    from staff AS sf
    left join dispatching_company as dc ON (sf.dc_id = dc.dc_id)
    left join factory_management as fm ON (sf.fm_id = fm.fm_id)
    WHERE biz_id = #{bizId} AND sf.is_delete = 0
  </select>

</mapper>