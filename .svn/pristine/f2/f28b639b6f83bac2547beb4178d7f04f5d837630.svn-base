<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.mingyuansoftware.aifactory.mapper.CustomerMapper">
    <resultMap id="BaseResultMap" type="com.mingyuansoftware.aifactory.model.Customer">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="customer_id" property="customerId" jdbcType="INTEGER"/>
        <result column="customer_number" property="customerNumber" jdbcType="VARCHAR"/>
        <result column="customer_name" property="customerName" jdbcType="VARCHAR"/>
        <result column="phone" property="phone" jdbcType="CHAR"/>
        <result column="address" property="address" jdbcType="VARCHAR"/>
        <result column="comment" property="comment" jdbcType="VARCHAR"/>
        <result column="introduction" property="introduction" jdbcType="VARCHAR"/>
        <result column="fax" property="fax" jdbcType="VARCHAR"/>
        <result column="financial_contact" property="financialContact" jdbcType="VARCHAR"/>
        <result column="bank_account" property="bankAccount" jdbcType="VARCHAR"/>
        <result column="account_number" property="accountNumber" jdbcType="VARCHAR"/>
        <result column="credit_code" property="creditCode" jdbcType="VARCHAR"/>
        <result column="tax_number" property="taxNumber" jdbcType="VARCHAR"/>
        <result column="account_period" property="accountPeriod" jdbcType="VARCHAR"/>
        <result column="return_credit" property="returnCredit" jdbcType="VARCHAR"/>
        <result column="customer_value" property="customerValue" jdbcType="VARCHAR"/>
        <result column="annual_sales" property="annualSales" jdbcType="VARCHAR"/>
        <result column="is_delete" property="isDelete" jdbcType="TINYINT"/>
        <result column="write_off_amount" property="writeOffAmount" jdbcType="DECIMAL" />
    </resultMap>
    <insert id="addCustomer" parameterType="com.mingyuansoftware.aifactory.model.Customer">
    insert into
      customer (customer_number, customer_name, phone,
      address, `comment`, introduction,
      fax, financial_contact, bank_account,
      account_number, credit_code, tax_number,
      account_period, return_credit, customer_value,
      annual_sales, write_off_amount)
    values (#{customer.customerNumber,jdbcType=VARCHAR}, #{customer.customerName,jdbcType=VARCHAR}, #{customer.phone,jdbcType=CHAR},
      #{customer.address,jdbcType=VARCHAR}, #{customer.comment,jdbcType=VARCHAR}, #{customer.introduction,jdbcType=VARCHAR},
      #{customer.fax,jdbcType=VARCHAR}, #{customer.financialContact,jdbcType=VARCHAR}, #{customer.bankAccount,jdbcType=VARCHAR},
      #{customer.accountNumber,jdbcType=VARCHAR}, #{customer.creditCode,jdbcType=VARCHAR}, #{customer.taxNumber,jdbcType=VARCHAR},
      #{customer.accountPeriod,jdbcType=VARCHAR}, #{customer.returnCredit,jdbcType=VARCHAR}, #{customer.customerValue,jdbcType=VARCHAR},
      #{customer.annualSales,jdbcType=VARCHAR}, #{customer.writeOffAmount,jdbcType=DECIMAL})
  </insert>
    <select id="selectCustomerByCId" resultMap="BaseResultMap" parameterType="java.lang.Integer">
        select c.customer_id,c.customer_number,c.customer_name,c.phone,c.address,c.`comment`,c.introduction,c.fax,
			   c.financial_contact,c.bank_account,c.account_number,c.credit_code,c.tax_number,c.account_period,c.return_credit,
			   c.customer_value,c.annual_sales,c.is_delete, c.write_off_amount
        from customer c
        <where>
            and c.customer_id = #{customerId,jdbcType=INTEGER}
            and c.is_delete = 0
        </where>
    </select>
    <select id="selectCustomerAll" resultMap="BaseResultMap"
            parameterType="com.mingyuansoftware.aifactory.model.dto.CustomerDto">
        select customer_id,customer_number,customer_name,phone,address,`comment`,introduction,fax,financial_contact,
        bank_account,account_number,credit_code,tax_number,account_period,return_credit,
        customer_value,annual_sales,is_delete
        from customer
        <where>
            <if test=" customerDto.customerNumber != null and customerDto.customerNumber != '' ">
                and customer_number like "%"#{customerDto.customerNumber}"%"
            </if>
            <if test=" customerDto.customerName != null and customerDto.customerName != '' ">
                and customer_name like "%"#{customerDto.customerName}"%"
            </if>
            <if test=" customerDto.phone != null and customerDto.phone != '' ">
                and phone like "%"#{customerDto.phone}"%"
            </if>
            <if test=" customerDto.address != null and customerDto.address != '' ">
                and address like "%"#{customerDto.address}"%"
            </if>
            <if test=" customerDto.comment != null and customerDto.comment != '' ">
                and `comment` like "%"#{customerDto.comment}"%"
            </if>
            and is_delete = 0
        </where>
    </select>
    <!--客户列表条数-->
    <select id="count" resultType="java.lang.Integer">
        select count(*)
        from customer
        <where>
            <if test=" customerDto.customerNumber != null and customerDto.customerNumber != '' ">
                and customer_number like "%"#{customerDto.customerNumber}"%"
            </if>
            <if test=" customerDto.customerName != null and customerDto.customerName != '' ">
                and customer_name like "%"#{customerDto.customerName}"%"
            </if>
            <if test=" customerDto.phone != null and customerDto.phone != '' ">
                and phone like "%"#{customerDto.phone}"%"
            </if>
            <if test=" customerDto.address != null and customerDto.address != '' ">
                and address like "%"#{customerDto.address}"%"
            </if>
            <if test=" customerDto.comment != null and customerDto.comment != '' ">
                and `comment` like "%"#{customerDto.comment}"%"
            </if>
            and is_delete = 0
        </where>
    </select>
    <!--编辑客户信息-->
    <update id="editCustomer" parameterType="com.mingyuansoftware.aifactory.model.Customer">
    update customer
    set customer_number = #{customer.customerNumber,jdbcType=VARCHAR},
    customer_name = #{customer.customerName,jdbcType=VARCHAR},
    phone = #{customer.phone,jdbcType=CHAR},
    address = #{customer.address,jdbcType=VARCHAR},
    `comment` = #{customer.comment,jdbcType=VARCHAR},
    introduction = #{customer.introduction,jdbcType=VARCHAR},
    fax = #{customer.fax,jdbcType=VARCHAR},
    financial_contact = #{customer.financialContact,jdbcType=VARCHAR},
    bank_account = #{customer.bankAccount,jdbcType=VARCHAR},
    account_number = #{customer.accountNumber,jdbcType=VARCHAR},
    credit_code = #{customer.creditCode,jdbcType=VARCHAR},
    tax_number = #{customer.taxNumber,jdbcType=VARCHAR},
    account_period = #{customer.accountPeriod,jdbcType=VARCHAR},
    return_credit = #{customer.returnCredit,jdbcType=VARCHAR},
    customer_value = #{customer.customerValue,jdbcType=VARCHAR},
    annual_sales = #{customer.annualSales,jdbcType=VARCHAR},
    write_off_amount = #{customer.writeOffAmount,jdbcType=DECIMAL}
    where customer_id = #{customer.customerId,jdbcType=INTEGER}
  </update>
    <update id="updateCustomer">
    update customer
	set is_delete = 1
    where customer_id = #{customerId,jdbcType=INTEGER}
  </update>

    <update id="updateWriteOffAmount" parameterType="map">
        update customer
        set write_off_amount = #{writeOffAmount,jdbcType=DECIMAL}
        where customer_id = #{customerId,jdbcType=INTEGER}
    </update>

    <select id="getCustomerNameList" resultMap="BaseResultMap">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select customer_id,customer_name
        from customer
        where is_delete = 0
    </select>
    <select id="selectLastId" resultType="java.lang.Integer">
        SELECT @@IDENTITY
    </select>
    <update id="updateWriteOffAmountByCId" >
    update customer
    set
    write_off_amount = #{subtract}
    where customer_id = #{customerId,jdbcType=INTEGER}
  </update>
    <!--write_off_amount = IFNULL((write_off_amount+#{subtract}),0)-->
</mapper>