<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.mingyuansoftware.aifactory.mapper.SupplierMapper" >
  <resultMap id="BaseResultMap" type="com.mingyuansoftware.aifactory.model.Supplier" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="supplier_id" property="supplierId" jdbcType="INTEGER" />
    <result column="supplier_name" property="supplierName" jdbcType="VARCHAR" />
    <result column="contact" property="contact" jdbcType="VARCHAR" />
    <result column="phone" property="phone" jdbcType="VARCHAR" />
    <result column="address" property="address" jdbcType="VARCHAR" />
    <result column="payee" property="payee" jdbcType="VARCHAR" />
    <result column="bank_account" property="bankAccount" jdbcType="VARCHAR" />
    <result column="account_number" property="accountNumber" jdbcType="VARCHAR" />
    <result column="tax_number" property="taxNumber" jdbcType="VARCHAR" />
    <result column="account_period" property="accountPeriod" jdbcType="VARCHAR" />
    <result column="supplier_number" property="supplierNumber" jdbcType="VARCHAR" />
    <result column="fax" property="fax" jdbcType="VARCHAR" />
    <result column="website" property="website" jdbcType="VARCHAR" />
    <result column="payment_method" property="paymentMethod" jdbcType="VARCHAR" />
    <result column="invoice_category" property="invoiceCategory" jdbcType="VARCHAR" />
    <result column="is_delete" property="isDelete" jdbcType="TINYINT" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
  </resultMap>

  <update id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
   UPDATE supplier set is_delete=1
    where supplier_id = #{supplierId,jdbcType=INTEGER}

  </update>
  <insert id="insert" parameterType="com.mingyuansoftware.aifactory.model.Supplier" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <selectKey resultType="java.lang.Integer" keyProperty="supplierId" order="AFTER" >
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into supplier (supplier_name, contact, phone, 
      address, payee, bank_account, 
      account_number, tax_number, account_period, 
      supplier_number, fax, website,email,
      payment_method, invoice_category, is_delete, 
      create_time, update_time)
    values (#{supplierName,jdbcType=VARCHAR}, #{contact,jdbcType=VARCHAR}, #{phone,jdbcType=VARCHAR}, 
      #{address,jdbcType=VARCHAR}, #{payee,jdbcType=VARCHAR}, #{bankAccount,jdbcType=VARCHAR}, 
      #{accountNumber,jdbcType=VARCHAR}, #{taxNumber,jdbcType=VARCHAR}, #{accountPeriod,jdbcType=VARCHAR}, 
      #{supplierNumber,jdbcType=VARCHAR}, #{fax,jdbcType=VARCHAR}, #{website,jdbcType=VARCHAR}, #{email,jdbcType=VARCHAR},
      #{paymentMethod,jdbcType=VARCHAR}, #{invoiceCategory,jdbcType=VARCHAR}, #{isDelete,jdbcType=TINYINT}, 
      #{createTime,jdbcType=TIMESTAMP}, #{updateTime,jdbcType=TIMESTAMP})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.mingyuansoftware.aifactory.model.Supplier" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update supplier
    set supplier_name = #{supplierName,jdbcType=VARCHAR},
      contact = #{contact,jdbcType=VARCHAR},
      phone = #{phone,jdbcType=VARCHAR},
      address = #{address,jdbcType=VARCHAR},
      email = #{email,jdbcType=VARCHAR},
      payee = #{payee,jdbcType=VARCHAR},
      bank_account = #{bankAccount,jdbcType=VARCHAR},
      account_number = #{accountNumber,jdbcType=VARCHAR},
      tax_number = #{taxNumber,jdbcType=VARCHAR},
      account_period = #{accountPeriod,jdbcType=VARCHAR},
      supplier_number = #{supplierNumber,jdbcType=VARCHAR},
      fax = #{fax,jdbcType=VARCHAR},
      website = #{website,jdbcType=VARCHAR},
      payment_method = #{paymentMethod,jdbcType=VARCHAR},
      invoice_category = #{invoiceCategory,jdbcType=VARCHAR},
      update_time = #{updateTime,jdbcType=TIMESTAMP}
    where supplier_id = #{supplierId,jdbcType=INTEGER}
  </update>
  <select id="selectByPrimaryKey" resultType="com.mingyuansoftware.aifactory.model.Supplier" parameterType="java.lang.Integer" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select s.supplier_id, s.supplier_name, s.contact, s.phone, s.address, s.payee, s.bank_account,
    s.account_number, s.tax_number, s.account_period, s.supplier_number, s.fax, s.website, s.payment_method,
    s.invoice_category, s.create_time, s.update_time, s.email,s.pending_amount
    from supplier s
    where s.supplier_id = #{supplierId,jdbcType=INTEGER} AND s.is_delete=0
  </select>
  <select id="selectByPage" resultMap="BaseResultMap" parameterType="com.mingyuansoftware.aifactory.model.dto.SupplierDto" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select supplier_id, supplier_name, contact, phone, address, payee, bank_account, 
    account_number, tax_number, account_period, supplier_number, fax, website, payment_method, 
    invoice_category, is_delete, create_time, update_time, email
    from supplier
    <where>
      <if test="supplierNumber != null and supplierNumber != ''">
        AND supplier_number like "%"#{supplierNumber}"%"
      </if>
      <if test="supplierName != null and supplierName != ''">
        AND supplier_name like "%"#{supplierName}"%"
      </if>
      <if test="email != null and email != ''">
        AND email like "%"#{email}"%"
      </if>
      <if test="contact != null and contact != ''">
        AND contact like "%"#{contact}"%"
      </if>
      <if test="phone != null and phone  != ''">
        AND phone like "%"#{phone }"%"
      </if>
      <if test="address != null and address != ''">
        AND address like "%"#{address}"%"
      </if>
      <if test="payee != null and payee != ''">
        AND payee like "%"#{payee}"%"
      </if>
      <if test="bankAccount != null and bankAccount  != ''">
        AND bank_account like "%"#{bankAccount }"%"
      </if>
      <if test="accountNumber != null and accountNumber != ''">
        AND account_number like "%"#{accountNumber}"%"
      </if>

      <if test="accountPeriod != null and accountPeriod != ''">
        AND account_period like "%"#{accountPeriod}"%"
      </if>

      AND is_delete = 0
    </where>
  </select>

  <select id="selectSupplierNameList" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select supplier_id, supplier_name
    from supplier
    where is_delete = 0
  </select>
  <update id="updateWriteOffAmountBySId" >
    update supplier
    set
    pending_amount = IFNULL((pending_amount-#{writeOffAmount}),0),
    update_time = now()
    where supplier_id = #{supplierId,jdbcType=INTEGER}
  </update>
  <update id="updatePendingAmountBySId" >
    update supplier
    set
    pending_amount = #{subtract}
    where supplier_id = #{supplierId,jdbcType=INTEGER}
  </update>
</mapper>